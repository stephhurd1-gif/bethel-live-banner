<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bethel Live Banner</title>

  <style>
    :root{
      /* Height (match your GoDaddy iframe section height) */
      --h-desktop: 84px;
      --h-mobile: 96px;

      /* OFFICIAL BETHEL AME COLORS */
      --black: #01060b;
      --gold:  #f7bf5b;
      --purple:#86239c;
      --green: #429e40;
      --white: #fffefe;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    /* Banner shell */
    .banner {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: var(--h-desktop);
      box-sizing: border-box;
      padding: 10px 14px;
      display: none;
      z-index: 9999;
      color: var(--white);

      /* Needed for the LIVE ‚Äúrays‚Äù overlay */
      position: fixed;
      overflow: hidden;

      /* Gentle slide-down on show */
      transform: translateY(-16px);
      opacity: 0;
      transition: transform 520ms ease, opacity 520ms ease;

      /* Depth */
      box-shadow: 0 10px 22px rgba(0,0,0,0.35);
    }

    .banner.is-visible {
      transform: translateY(0);
      opacity: 1;
    }

    .bannerInner {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
      z-index: 2; /* keep text above backgrounds */
    }

    a.bannerLink {
      color: var(--white);
      text-decoration: none;
      width: 100%;
      max-width: 1100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      line-height: 1.12;
      border-radius: 999px;
      padding: 10px 18px;
      box-sizing: border-box;
      cursor: pointer;
    }

    /* Title / subtext */
    .titleRow {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-weight: 900;
      letter-spacing: 0.2px;
      font-size: 22px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.25);
    }

    .subRow {
      font-size: 14px;
      font-weight: 700;
      opacity: 0.95;
      text-shadow: 0 2px 10px rgba(0,0,0,0.20);
    }

    /* LIVE badge */
    .liveBadge {
      background: linear-gradient(180deg, #fff1c9, var(--gold));
      color: #2b1b05;
      font-size: 12px;
      font-weight: 900;
      padding: 6px 12px;
      border-radius: 999px;
      letter-spacing: 0.9px;
      box-shadow: 0 6px 16px rgba(1,6,11,0.35);
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }

    /* Soft shimmer across LIVE badge */
    .liveBadge::after {
      content: "";
      position: absolute;
      top: -30%;
      left: -40%;
      width: 60%;
      height: 180%;
      background: rgba(255,255,255,0.35);
      transform: rotate(22deg);
      animation: badgeShine 2.2s ease-in-out infinite;
    }

    @keyframes badgeShine {
      0% { left: -60%; opacity: 0; }
      30% { opacity: 0.45; }
      60% { opacity: 0.15; }
      100% { left: 140%; opacity: 0; }
    }

    /* LIVE look: Purple + Gold animated gradient, subtle glow */
    .banner.live {
      background: linear-gradient(
        270deg,
        var(--purple),
        #6f1f85,
        var(--gold),
        var(--purple)
      );
      background-size: 600% 600%;
      animation: gradientMove 9s ease infinite;
      box-shadow:
        0 0 28px rgba(134,35,156,0.60),
        0 10px 22px rgba(1,6,11,0.45);
    }

    /* üîÜ subtle sun-ray texture for LIVE (sits behind text) */
    .banner.live::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        repeating-conic-gradient(
          from 0deg,
          rgba(247,191,91,0.08) 0deg 10deg,
          rgba(1,6,11,0)        10deg 20deg
        );
      opacity: 0.55;
      pointer-events: none;
      z-index: 1;
    }

    .banner.live a.bannerLink {
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(247,191,91,0.80);
      box-shadow:
        0 0 0 1px rgba(247,191,91,0.18) inset,
        0 14px 30px rgba(1,6,11,0.25);
    }

    /* OFFLINE look: Black + Gold (different vibe) */
    .banner.offline {
      background: linear-gradient(
        270deg,
        var(--black),
        #06121a,
        var(--black)
      );
      background-size: 600% 600%;
      animation: gradientMove 14s ease infinite;
      box-shadow: 0 10px 22px rgba(1,6,11,0.65);
    }

    .banner.offline a.bannerLink {
      background: rgba(247,191,91,0.12);
      border: 1px solid rgba(247,191,91,0.60);
      box-shadow:
        0 0 0 1px rgba(247,191,91,0.20) inset,
        0 12px 26px rgba(1,6,11,0.35);
    }

    @keyframes gradientMove {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Spacer so content under iframe isn't covered */
    #spacer {
      display: none;
      height: var(--h-desktop);
    }

    /* Mobile adjustments */
    @media (max-width: 520px){
      .banner { height: var(--h-mobile); padding: 10px 10px; }
      #spacer { height: var(--h-mobile); }
      a.bannerLink { border-radius: 22px; padding: 10px 14px; }
      .titleRow { font-size: 18px; gap: 8px; }
      .subRow { font-size: 13px; }
    }
  </style>
</head>

<body>
  <div id="banner" class="banner">
    <div class="bannerInner">
      <a id="link" class="bannerLink" href="#" target="_top" rel="noopener">
        <span id="title" class="titleRow"></span>
        <span id="sub" class="subRow"></span>
      </a>
    </div>
  </div>

  <div id="spacer"></div>

  <script>
    (function () {
      // ====== CONFIG ======
      const API_KEY    = "AIzaSyAUjf8QLzCafhgxSI8LN7e116-VZgcw4kg";
      const CHANNEL_ID = "UCvFyu7ybvACGGblAZxuE93g";

      const WATCH_LIVE_PAGE = "https://bethelamelancaster.com/watch-live";

      // Polling (quota-safe)
      const POLL_FAST_MS = 60 * 1000;       // 1 min during service window
      const POLL_SLOW_MS = 10 * 60 * 1000;  // 10 min otherwise

      // Service window (local time of the viewer device)
      // Sunday 8am‚Äì1pm is a safe window; adjust if you want.
      function isServiceWindow() {
        const now = new Date();
        const day = now.getDay();   // 0 = Sunday
        const hr  = now.getHours(); // 0-23
        return day === 0 && hr >= 8 && hr <= 13;
      }

      // ====== ELEMENTS ======
      const banner = document.getElementById("banner");
      const spacer = document.getElementById("spacer");
      const link   = document.getElementById("link");
      const title  = document.getElementById("title");
      const sub    = document.getElementById("sub");

      // ====== OVERRIDE LOGIC ======
      // URL overrides:
      //   ?forceLive=1      -> force LIVE
      //   ?forceLive=0      -> clear override (back to auto)
      //   ?forceOffline=1   -> force OFFLINE
      //
      // Stored in localStorage so you can flip it once and it sticks.
      const params = new URLSearchParams(window.location.search);

      if (params.get("forceLive") === "1") {
        localStorage.setItem("bethelForceState", "live");
      } else if (params.get("forceOffline") === "1") {
        localStorage.setItem("bethelForceState", "offline");
      } else if (params.get("forceLive") === "0" || params.get("forceOffline") === "0") {
        localStorage.removeItem("bethelForceState");
      }

      function getForcedState() {
        return localStorage.getItem("bethelForceState"); // "live" | "offline" | null
      }

      // ====== UI HELPERS ======
      function reveal() {
        banner.style.display = "block";
        spacer.style.display = "block";
        requestAnimationFrame(() => banner.classList.add("is-visible"));
      }

      function setState(state) {
        // Don‚Äôt clobber is-visible: use classList
        banner.classList.remove("live", "offline");
        banner.classList.add(state);

        // Common
        link.href = WATCH_LIVE_PAGE;

        if (state === "live") {
          title.innerHTML = '<span class="liveBadge">LIVE</span> Watch Live Now';
          sub.textContent = "Join us Sundays at 9:30 AM ‚Ä¢ Worship with us online";
        } else {
          title.innerHTML = "‚ú® Watch the Latest Service Replay";
          sub.textContent = "Join us Sundays at 9:30 AM ‚Ä¢ All Are Welcome";
        }

        reveal();
      }

      // ====== YOUTUBE CHECK ======
      async function checkLiveOnce() {
        const forced = getForcedState();
        if (forced === "live")  { setState("live"); return; }
        if (forced === "offline"){ setState("offline"); return; }

        // If there‚Äôs no key, just fall back to offline (production-safe)
        if (!API_KEY || API_KEY === "AIzaSyAUjf8QLzCafhgxSI8LN7e116-VZgcw4kg") {
          setState("offline");
          return;
        }

        try {
          const url =
            "https://www.googleapis.com/youtube/v3/search" +
            "?part=snippet" +
            "&channelId=" + encodeURIComponent(CHANNEL_ID) +
            "&eventType=live" +
            "&type=video" +
            "&maxResults=1" +
            "&key=" + encodeURIComponent(API_KEY);

          const res = await fetch(url, { cache: "no-store" });

          // Quota / error -> fail gracefully to offline (no scary errors)
          if (!res.ok) {
            setState("offline");
            return;
          }

          const data = await res.json();
          const item = data.items && data.items[0];

          if (item && item.id && item.id.videoId) {
            setState("live");
          } else {
            setState("offline");
          }
        } catch (e) {
          setState("offline");
        }
      }

      // ====== START + SMART POLLING ======
      checkLiveOnce();

      // Adaptive polling to prevent quota burn:
      // - During service window: every 1 minute
      // - Otherwise: every 10 minutes
      let pollTimer = null;
      function startPolling() {
        if (pollTimer) clearInterval(pollTimer);
        const interval = isServiceWindow() ? POLL_FAST_MS : POLL_SLOW_MS;
        pollTimer = setInterval(checkLiveOnce, interval);
      }
      startPolling();

      // Re-evaluate polling speed every 15 minutes
      setInterval(startPolling, 15 * 60 * 1000);
    })();
  </script>
</body>
</html>
