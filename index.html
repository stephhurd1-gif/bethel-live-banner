<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Banner</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
    }

    .banner {
      width: 100%;
      box-sizing: border-box;
      padding: 12px 14px;
      font-family: Arial, sans-serif;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.2px;
      color: #fff;
      display: none;
    }

    .banner a {
      color: #fff;
      text-decoration: none;
      display: block;
      width: 100%;
    }

    .live {
      background: #E41C23; /* red */
    }

    .offline {
      background: #111111; /* black */
    }
  </style>
</head>
<body>

  <div id="banner" class="banner">
    <a id="bannerLink" href="#" target="_blank" rel="noopener">
      Loadingâ€¦
    </a>
  </div>

  <script>
    (function () {

      const API_KEY     = "AIzaSyAydGEq9gQCC8QEKRS7gUK6QODYPaMveI4";
      const CHANNEL_ID  = "UCvFyu7ybvACGGblAZxuE93g";
      const PLAYLIST_ID = "PLREUaQOGIVDZ29eYTc6EGN7gXwgBWioHq";

      const banner = document.getElementById("banner");
      const link   = document.getElementById("bannerLink");

      function showLive(videoId) {
        banner.className = "banner live";
        link.textContent = "ðŸ”´ Watch Live Now";
        link.href = "https://www.bethelamelancaster.com/watch-live";
        banner.style.display = "block";
      }

      function showOffline() {
        banner.className = "banner offline";
        link.textContent = "â–¶ Watch Last Service";
        link.href = "https://www.bethelamelancaster.com/watch-live;
        banner.style.display = "block";
      }

      async function checkLive() {
        try {
          const url =
            "https://www.googleapis.com/youtube/v3/search" +
            "?part=snippet" +
            "&channelId=" + encodeURIComponent(CHANNEL_ID) +
            "&eventType=live" +
            "&type=video" +
            "&maxResults=1" +
            "&key=" + encodeURIComponent(API_KEY);

          const res = await fetch(url, { cache: "no-store" });
          if (!res.ok) throw new Error("YT API " + res.status);

          const data = await res.json();
          const item = data.items && data.items[0];

          if (item && item.id && item.id.videoId) {
            showLive(item.id.videoId);
          } else {
            showOffline();
          }
        } catch (e) {
          // If API fails, fail gracefully to offline state
          showOffline();
        }
      }

      checkLive();
      setInterval(checkLive, 60000); // re-check every minute

    })();
  </script>

</body>
</html>
